<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AllAbroad | Kullanıcı Profili</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>
<body>
    <header>
        <a href="index.html" class="logo">
            <span class="all">All</span><span class="abroad">Abroad</span>
        </a>
        <div class="nav-right">
            <nav class="main-nav">
                <ul>
                    <li class="dropdown">
                        <a href="continents.html">Kıtalar</a>
                        <div class="dropdown-content">
                            <a href="continents/europe.html">Avrupa</a>
                            <a href="continents/americas.html">Amerika</a>
                            <a href="continents/asia.html">Asya</a>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a href="universities.html">Üniversiteler</a>
                        <div class="dropdown-content">
                            <a href="universities.html">Tüm Üniversiteler</a>
                        </div>
                    </li>
                    <li><a href="scholarships.html">Burslar</a></li>
                    <li><a href="about.html">Hakkımızda</a></li>
                </ul>
            </nav>
            <div class="search-box">
                <span class="search-icon">⌕</span>
                <input type="text" placeholder="Search">
            </div>
            <a href="user.html" class="user-btn" style="display:none;"><i class="fas fa-user-circle" style="color:#E63946;font-size:28px;"></i></a>
            <a href="login.html" class="login-btn">Giriş Yap</a>
        </div>
    </header>
    <main class="main-content">
        <h1 class="page-title">Kullanıcı Paneli</h1>
        <nav class="user-menu" style="margin: 0 auto; max-width: 600px; text-align: center;">
            <a href="#userinfo" class="user-menu-link" onclick="showSection('userinfo')">Kullanıcı Bilgileri</a> |
            <a href="#calendar" class="user-menu-link" onclick="showSection('calendar')">Takvim</a> |
            <a href="#myuniversities" class="user-menu-link" onclick="showSection('myuniversities')">Üniversitelerim</a> |
            <a href="#wizard" class="user-menu-link" onclick="showSection('wizard')">AllAbroad Sihirbazı</a>
        </nav>
        <section id="userinfo">
            <div id="user-info" style="max-width:600px;margin:0 auto;text-align:center;"></div>
        </section>
        <div style="text-align:center; margin: 18px 0 0 0;">
            <button id="sign-out-btn" style="background:#E63946;color:#fff;border:none;padding:8px 14px;border-radius:10px;cursor:pointer;">Çıkış Yap</button>
        </div>
        <section id="calendar" style="display:none;">
            <h2>Takvim (Yakında)</h2>
        </section>
        <section id="myuniversities" style="display:none;">
            <h2>Üniversitelerim (Yakında)</h2>
        </section>
        <section id="wizard" style="display:none;">
            <h2>AllAbroad Sihirbazı (Yakında)</h2>
        </section>
    </main>
            <div class="subfooter-wrapper">
                <div class="subfooter">
                    <div class="subfooter-content">
                        <div class="subfooter-column">
                            <h4>Kıtalar</h4>
                            <ul>
                                <li><a href="continents/europe.html">Avrupa</a></li>
                                <li><a href="continents/americas.html">Amerika</a></li>
                                <li><a href="continents/asia.html">Asya</a></li>
                            </ul>
                        </div>
                        <div class="subfooter-column">
                            <h4>Üniversiteler</h4>
                            <ul>
                                <li><a href="universities.html">Tüm Üniversiteler</a></li>
                                <li><a href="universities.html"> </a></li>
                            </ul>
                        </div>
                        <div class="subfooter-column">
                            <h4>Kaynaklar</h4>
                            <ul>
                                <li><a href="scholarships.html">Burslar</a></li>
                                <li><a href="finder.html">AllAbroad Sihirbazı</a></li>
                            </ul>
                        </div>
                        <div class="subfooter-column">
                            <h4>Şirket</h4>
                            <ul>
                                <li><a href="about.html">Hakkımızda</a></li>
                                <li><a href="contact.html">İletişim</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="subfooter-bottom">
                        <p>&copy; 2024 AllAbroad. Tüm hakları saklıdır. </p>
                    </div>
                </div>
            </div>
            <script type="module" src="firebase-init.js"></script>
            <script type="module" src="user-profile.js"></script>
            <script type="module" src="auth-ui.js"></script>
            <script type="module">
                import { auth } from './firebase-init.js';
                import { signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

                function showSection(id) {
                    document.getElementById('userinfo').style.display = 'none';
                    document.getElementById('calendar').style.display = 'none';
                    document.getElementById('myuniversities').style.display = 'none';
                    document.getElementById('wizard').style.display = 'none';
                    document.getElementById(id).style.display = 'block';
                }

                // show user info when available
                function renderUserInfo(user) {
                    const el = document.getElementById('user-info');
                    if (!el) return;
                    if (!user) {
                        el.innerHTML = '<p>Lütfen giriş yapın.</p><p><a href="login.html" class="login-btn">Giriş Yap</a></p>';
                        return;
                    }
                    const email = user.email || '';
                    const name = user.displayName || email.split('@')[0];
                    el.innerHTML = `
                        <div style="font-size:18px;font-weight:600;color:#222;margin-bottom:8px;">Hoşgeldiniz, ${name}</div>
                        <div style="color:#666;margin-bottom:6px;">${email}</div>
                        <div style="margin-top:12px;">
                            <a href="user.html#userinfo" class="button">Profil Düzenle</a>
                        </div>
                    `;
                }

                // load current user from modular auth
                if (auth && auth.currentUser) {
                    renderUserInfo(auth.currentUser);
                }
                // also listen for changes using modular API
                try { onAuthStateChanged(auth, (u) => renderUserInfo(u)); } catch (e) {}

                document.getElementById('sign-out-btn')?.addEventListener('click', async function() {
                    try {
                        await signOut(auth);
                        if (window.allabroadAuthUpdate) window.allabroadAuthUpdate(false);
                    } catch (e) {
                        console.error('Sign out failed', e);
                    } finally {
                        try { localStorage.setItem('allabroad_signed_in', '0'); } catch (e) {}
                        // redirect to home after sign out
                        window.location.href = 'index.html';
                    }
                });

                // Simple data for calendar and universities
                const upcomingEvents = [
                    { date: '2025-11-01', title: 'UCAS application workshop' },
                    { date: '2025-12-10', title: 'Scholarship deadline reminder' }
                ];
                const myUnis = [
                    { name: 'University of Example', status: 'Interested' }
                ];

                function renderCalendar() {
                    const el = document.getElementById('calendar');
                    el.innerHTML = `<h2>Yaklaşan Etkinlikler</h2>` + upcomingEvents.map(ev => `
                        <div style="padding:10px 0;border-bottom:1px solid #eee;"><strong>${ev.date}</strong> — ${ev.title}</div>`).join('');
                }

                function renderMyUnis() {
                    const el = document.getElementById('myuniversities');
                    el.innerHTML = `<h2>Üniversitelerim</h2>` + myUnis.map(u => `
                        <div style="padding:10px 0;border-bottom:1px solid #eee;"><strong>${u.name}</strong> — ${u.status}</div>`).join('');
                }

                function renderWizard() {
                    const el = document.getElementById('wizard');
                    el.innerHTML = `
                        <h2>AllAbroad Sihirbazı</h2>
                        <p>Hızlı tercih oluşturucu: tercihlerinize göre üniversite önerileri alabilirsiniz.</p>
                        <div style="display:flex;gap:8px;margin-top:12px;">
                            <input id="wizard-country" placeholder="Tercih ülke (ör. UK)" style="padding:8px;border:1px solid #ddd;border-radius:8px;flex:1;" />
                            <button id="wizard-run" style="background:#E63946;color:#fff;border:none;padding:8px 12px;border-radius:8px;">Öner</button>
                        </div>
                        <div id="wizard-results" style="margin-top:12px;"></div>
                    `;
                    document.getElementById('wizard-run').addEventListener('click', function() {
                        const q = document.getElementById('wizard-country').value || 'any';
                        document.getElementById('wizard-results').innerHTML = `<div style="padding:10px;background:#fff;border-radius:8px;">Öneriler: ${q} için örnek üniversite A, B, C</div>`;
                    });
                }

                // initial renders
                renderCalendar();
                renderMyUnis();
                renderWizard();
            </script>
    </body>
    </html>
